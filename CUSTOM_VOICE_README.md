# 客製化語音功能說明

## 功能概述

本專案已成功整合客製化語音功能，允許使用者錄製自己的聲音來替換系統的預設語音提示。使用者可以創建個人化的語音體驗，讓系統使用自己的聲音進行各種語音提示。

## 主要特點

### 🎙️ 錄音功能
- 使用 PyAudio 進行高品質錄音
- 支援即時錄音和播放
- 自動音量標準化和靜音去除
- 音訊處理和優化（使用 librosa）

### 📁 語音設定檔管理
- 支持多個語音設定檔
- 每個設定檔包含5個基本語音樣本
- 可隨時切換不同的語音設定檔
- 支持刪除和重新錄製

### 🔧 智能語音替換
- 自動識別語音提示類型
- 無縫整合現有 Azure TTS 系統
- 備用機制：如果客製化語音不可用，自動回退到 TTS
- 支援中英文關鍵字識別

## 安裝和設定

### 1. 安裝依賴
```bash
pip install -r requirements.txt
```

新增的依賴包括：
- `pyaudio>=0.2.11` - 錄音功能
- `soundfile>=0.12.1` - 音訊檔案處理
- `librosa>=0.10.0` - 音訊處理和分析

### 2. 啟動程式
```bash
python main.py
```

## 使用方法

### 1. 開啟客製化語音設定
在主介面中點擊 **"🎙️客製化語音設定"** 按鈕。

### 2. 創建語音設定檔
1. 點擊 **"新增設定檔"** 按鈕
2. 輸入設定檔名稱（例如："我的聲音"）
3. 點擊確認創建

### 3. 錄製語音樣本
需要錄製以下5個基本語音樣本：

| 樣本類型 | 建議錄音內容 | 用途 |
|---------|-------------|------|
| 歡迎語音 | "歡迎使用口述影像生成系統" | 系統啟動歡迎 |
| 系統就緒 | "系統準備就緒" | 系統初始化完成 |
| 處理中 | "正在處理中" | 任務執行提示 |
| 完成提示 | "處理完成" | 任務成功完成 |
| 錯誤提示 | "發生錯誤" | 錯誤狀況提示 |

**錄音步驟：**
1. 選擇要錄製的語音樣本
2. 點擊對應的 **"🎤 錄音"** 按鈕
3. 在彈出的提示框中點擊確定
4. 清晰說出建議的錄音內容
5. 點擊 **"⏹️ 停止"** 按鈕結束錄音
6. 系統會自動處理和保存錄音

### 4. 設為預設語音
1. 選擇完成錄音的語音設定檔
2. 點擊 **"設為預設"** 按鈕
3. 系統會使用您的聲音進行語音提示

## 技術實現

### 檔案結構
```
project/
├── custom_voice.py          # 客製化語音系統核心
├── voice_interface.py        # 語音介面（已整合客製化功能）
├── main.py                  # 主程式（已添加客製化語音按鈕）
├── requirements.txt         # 依賴清單（已更新）
└── custom_voices/          # 語音設定檔目錄
    ├── voice_settings.json # 語音設定檔
    └── [設定檔名稱]/       # 各個語音設定檔
        ├── hello.wav       # 歡迎語音
        ├── system_ready.wav # 系統就緒
        ├── processing.wav  # 處理中
        ├── completed.wav   # 完成提示
        └── error.wav       # 錯誤提示
```

### 核心類別和方法

#### CustomVoiceSystem
- `create_voice_profile(name)` - 創建語音設定檔
- `start_recording(callback)` - 開始錄音
- `stop_recording()` - 停止錄音
- `save_voice_sample(profile, type, path)` - 保存語音樣本
- `get_voice_profiles()` - 獲取所有設定檔
- `set_active_voice_profile(name)` - 設定預設語音

#### 語音檔案映射
系統會根據文字內容自動選擇對應的客製化語音檔案：

- 包含 "歡迎"、"使用"、"您好" 等關鍵字 → `hello.wav`
- 包含 "準備就緒"、"系統"、"初始化" 等關鍵字 → `system_ready.wav`
- 包含 "正在"、"處理"、"生成" 等關鍵字 → `processing.wav`
- 包含 "完成"、"成功"、"已" 等關鍵字 → `completed.wav`
- 包含 "錯誤"、"失敗"、"無法" 等關鍵字 → `error.wav`

## 故障排除

### 常見問題

**Q: 無法錄音，提示找不到麥克風**
A: 請檢查：
1. 麥克風是否正確連接
2. 系統是否授予麥克風權限
3. PyAudio 是否正確安裝

**Q: 錄音品質不佳**
A: 建議：
1. 在安靜環境中錄音
2. 保持適當的麥克風距離（10-20cm）
3. 清晰說話，語速適中

**Q: 設定客製化語音後沒有效果**
A: 請檢查：
1. 是否成功錄製了所有5個語音樣本
2. 是否正確設為預設語音
3. 語音檔案是否存在且可讀取

**Q: 系統回退到 TTS 語音**
A: 這是正常的備用機制，可能原因：
1. 客製化語音檔案損壞
2. 當前文字沒有對應的客製化語音
3. 客製化語音系統初始化失敗

### 日誌資訊
系統會輸出相關的日誌資訊，包括：
- 客製化語音系統啟用狀態
- 錄音成功/失敗訊息
- 語音檔案播放狀態
- 回退到 TTS 的原因

## 開發者資訊

### 擴展客製化語音類型
要添加新的語音類型，需要：

1. 在 `CustomVoiceDialog.recording_items` 中添加新項目
2. 在 `_get_custom_voice_file()` 函數中添加對應的關鍵字判斷
3. 更新錄音介面和檔案驗證邏輯

### 自定義音訊處理
可以在 `_process_audio_file()` 方法中調整音訊處理參數：
- 音量標準化程度
- 靜音去除閾值
- 最小錄音長度
- 音訊格式和品質

## 版本資訊

- **版本**: 1.0.0
- **新增功能**: 客製化語音系統
- **相容性**: 與現有 Azure TTS 系統完全相容
- **依賴**: Python 3.7+, PyAudio, librosa, soundfile

---

*本功能為專案的客製化語音擴展，旨在提供更個人化的用戶體驗。如有問題或建議，請聯繫開發團隊。*